<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseline Cash Mining Pool</title>
    <link rel="icon" href="data:image/png;base64,{{ logo_b64 }}" type="image/png">
    <style>
        /* CSS_INJECTION_POINT */
    </style>
</head>

<body>
    <header class="top-bar">
        <div class="brand">
            <img src="data:image/png;base64,{{ logo_b64 }}" alt="Baseline Logo" height="40">
            <div>
                <h1>Baseline Cash</h1>
                <p class="subtitle">Mining Pool</p>
            </div>
        </div>
        <div class="header-actions">
            <!-- Nav Link -->
            <a href="#mining-guide" class="nav-link">How to Mine</a>
            <span class="badge">{{ sync_state }}</span>
        </div>
    </header>

    <main class="content">
        <!-- Pool Info Box -->
        <div class="connection-info">
            <div class="connection-detail">
                <span class="detail-label">Pool Fee:</span>
                <strong>{{ pool_fee }}%</strong>
            </div>
            <div class="connection-detail">
                <span class="detail-label">Min Payout:</span>
                <strong>{{ min_payout }} BLINE</strong>
            </div>
            <div class="connection-detail">
                <span class="detail-label">Payout Scheme:</span>
                <strong>PROP (Proportional)</strong>
            </div>
            <div class="connection-detail">
                <span class="detail-label">Stratum:</span>
                <strong>{{ stratum_url }}</strong>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-label">Pool Hashrate</div>
                <div class="stat-value">{{ pool_hashrate }}</div>
                <div class="stat-sub">{{ active_miners }} Active Workers</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Pending Balance</div>
                <div class="stat-value">{{ balance_total }} <small>BLINE</small></div>
                <div class="stat-sub">Distributable Rewards</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Network Info</div>
                <div class="stat-value">#{{ block_height }}</div>
                <div class="stat-sub">Current Height</div>
            </div>
        </div>


        <details class="worker-details">
            <summary>
                <span>Workers ({{ active_miners }})</span>
                <span class="summary-arrow" aria-hidden="true"></span>
            </summary>
            <p class="muted" style="padding: 0 1.5rem 1rem;">
                "Pending Balance" includes shares that are still maturing (20 blocks), while "Available Balance" is paid out after reaching the minimum payout threshold.
            </p>
            <div class="worker-filter">
                <label class="filter-label" for="address-filter">Address filter</label>
                <div class="filter-controls">
                    <input id="address-filter" type="search" placeholder="Paste or type a wallet address" autocomplete="off" spellcheck="false">
                    <button class="filter-clear" type="button" id="address-filter-clear">Clear</button>
                </div>
                <div class="filter-meta">
                    <span class="filter-hint">Matches update as you type.</span>
                    <span class="filter-count" id="address-filter-count"></span>
                </div>
            </div>
            <div class="table-scroll">
                <table id="workers-table">
                    <thead>
                    <tr>
                        <th>Worker Name</th>
                        <th>Address</th>
                        <th>Pending Balance</th>
                        <th>Available Balance</th>
                    </tr>
                    </thead>
                    <tbody>
                        {{ workers_rows }}
                        <tr class="empty-state filter-empty" data-filter-empty="true" style="display: none;">
                            <td colspan="4">No matching workers</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </details>

        <h2 class="section-title">Recent Payouts</h2>
        <div class="table-scroll">
            <table>
                <thead>
                    <tr>
                        <th>Transaction</th>
                        <th>Total Paid (BLINE)</th>
                        <th>Payees</th>
                        <th>Time (UTC)</th>
                    </tr>
                </thead>
                <tbody>
                    {{ payouts_rows }}
                </tbody>
            </table>
        </div>

        <!-- Mining Guide Section -->
        <div id="mining-guide" class="doc-section">
            <h2>How to Mine</h2>
            <p>To mine on this pool, you need the specialized miner: <strong>baseline-miner</strong>.</p>

            <p><strong>1. Install</strong></p>
            <pre class="code-block">
git clone https://github.com/Baseline-Blockchain/baseline-miner.git
cd baseline-miner
py -3 -m venv .venv # or python3 -m venv .venv on linux
.venv\Scripts\activate # or source .venv/bin/activate on linux
pip install -e .
            </pre>

            <p><strong>2. Connect</strong></p>
            <pre class="code-block">
CPU:
baseline-miner --host <span style="color: var(--accent);">{{ stratum_host }}</span> --port <span style="color: var(--accent);">{{ stratum_port }}</span> --address YOURADDRESS --worker worker1

GPU (faster):
baseline-miner --gpu --host <span style="color: var(--accent);">{{ stratum_host }}</span> --port <span style="color: var(--accent);">{{ stratum_port }}</span> --address YOURADDRESS --worker worker1
            </pre>
        </div>
    </main>

    <footer>
        <p>Powered by Baseline Node v{{ node_version }}</p>
    </footer>
    <script>
        (() => {
            const filterInput = document.getElementById("address-filter");
            const clearButton = document.getElementById("address-filter-clear");
            const countLabel = document.getElementById("address-filter-count");
            const table = document.getElementById("workers-table");
            const paramKey = "address";

            if (!filterInput || !table) {
                return;
            }

            const rows = Array.from(table.querySelectorAll("tbody tr"));
            const dataRows = rows.filter((row) => row.dataset.address);
            const filterEmptyRow = table.querySelector("tbody tr[data-filter-empty='true']");

            const applyUrlFilter = () => {
                const params = new URLSearchParams(window.location.search);
                const initial = params.get(paramKey);
                if (initial) {
                    filterInput.value = initial;
                }
            };

            const syncUrl = (query) => {
                const url = new URL(window.location.href);
                if (query) {
                    url.searchParams.set(paramKey, query);
                } else {
                    url.searchParams.delete(paramKey);
                }
                window.history.replaceState({}, "", url);
            };

            const updateFilter = () => {
                const query = filterInput.value.trim().toLowerCase();
                let matches = 0;

                dataRows.forEach((row) => {
                    const address = (row.dataset.address || "").toLowerCase();
                    const match = !query || address.includes(query);
                    row.style.display = match ? "" : "none";
                    if (match) {
                        matches += 1;
                    }
                });

                if (filterEmptyRow) {
                    const showEmpty = query && dataRows.length > 0 && matches === 0;
                    filterEmptyRow.style.display = showEmpty ? "" : "none";
                }

                if (countLabel) {
                    countLabel.textContent =
                        query && dataRows.length > 0
                            ? `${matches} match${matches === 1 ? "" : "es"}`
                            : "";
                }

                if (clearButton) {
                    clearButton.disabled = !query;
                }

                syncUrl(query);
            };

            applyUrlFilter();
            filterInput.addEventListener("input", updateFilter);
            if (clearButton) {
                clearButton.addEventListener("click", () => {
                    filterInput.value = "";
                    filterInput.focus();
                    updateFilter();
                });
            }

            updateFilter();
        })();
    </script>
</body>

</html>
